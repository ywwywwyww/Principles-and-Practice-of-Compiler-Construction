# PA3 report

## 大致思路

### vtable

　　把所有的静态成员方法放到了虚表里面。

### functype

　　给每一个函数类型的变量开一段空间，其中 `*(p+0)` 为函数地址，`*(p+1)` 为其他参数个数，`*(p+2) ~ *(p+len+1)` 处为其他参数。其他参数包含 this（若有则一定为第一个）、捕获的参数等。

### call

　　调用函数时先把其他参数传进去再传调用时给出的实参。

### lambda

　　由于无法直接把一个函数地址（标签）赋值给一个变量，因此新建了一个类用来保存所有的 lambda expr（在 namer&typer 里实现）。这样就可以通过这个类的虚表来获得对应的函数地址了。另外还要在 typer 中记下捕获的变量（以及对应的编号）。

　　在 visitLambdaDef 的时候，先找到所有捕获的变量（是当前作用域中定义的变量还是当前 lambda expr 捕获的变量），然后把这些变量加到 functype 的其他参数里面去。

### 动态错误检查

　　直接抄已经有的错误处理流程就好了。

## 遇到的困难

　　simulator 经常 RE，然后只能肉眼看 TAC 查错。