# report-PA4

　　在这次作业中，我实现了死代码消除、常量传播和复写传播。

## 死代码消除

　　死代码消除可以消除无用的语句，减少指令条数。

　　（基于活跃变量分析的）死代码消除只需要删除所有没有副作用且赋值目标不再活跃的语句。框架中已经实现了活跃变量分析，因此只需要几行代码就可以判断赋值目标是否活跃并删除了。

## 常量传播

　　常量传播（包含常量折叠）可以帮助我们在编译期间确定哪些变量会是常量，并配合死代码消除减少无用的计算。

　　实现方法参考了文档。先做一遍数据流分析找到每个变量的每次定值是否是常量，并针对每种指令进行处理。例如如果一个二元运算指令的两个操作数都是常量，我们就可以在编译期间确定运算结果。进一步的，如果一个二元运算指令的其中一个操作数是常量，有时候也可以帮助我们简化代码。

## 复写传播

　　复写传播可以配合死代码消除来消除冗余的复写语句。

　　实现方法参考了文档。先做一遍数据流分析找到每个变量的每次应用能替换成什么变量，然后对于每条指令的每个变量引用引用都进行替换。

## 性能测试结果

　　由于正常人写的代码在经过正常的编译器编译后不太可能产生死代码，因此我额外构造了一个测例（dead code elimination test）用于对比。

　　可以看出，这三种优化方法都有很好的效果。同时加入了这三种优化能在公开测例中减少约 $5\%$ 的指令。

|          program           | without optimize | dead code elimination | constant propagation + dead code elimination | copy propagation + dead code elimination | copy propagation + constant propagation + dead code elimination |
| :------------------------: | :--------------: | :-------------------: | :------------------------------------------: | :--------------------------------------: | :----------------------------------------------------------: |
|           basic            |        41        |          41           |                      38                      |                    37                    |                              37                              |
|         fibonacci          |       3426       |         3426          |                     3425                     |                   3425                   |                             3424                             |
|            math            |       139        |          139          |                     135                      |                   139                    |                             135                              |
|           queue            |       2536       |         2536          |                     2532                     |                   2475                   |                             2471                             |
|           stack            |       733        |          733          |                     730                      |                   729                    |                             726                              |
|         mandelbrot         |     3893085      |        3893085        |                   3782375                    |                 3815338                  |                           3704632                            |
|           rbtree           |     2439827      |        2439827        |                   2439816                    |                 2356805                  |                           2356794                            |
|            sort            |      560987      |        560987         |                    559980                    |                  558593                  |                            557586                            |
| dead code elimination test |     2700009      |        700009         |                    70008                     |                  700009                  |                            700008                            |

